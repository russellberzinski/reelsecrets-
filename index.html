<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BestFishingSecrets — Test Feed</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b1220;color:#e8edf7}
    header{padding:18px 16px;border-bottom:1px solid #223152;background:#0f1a33;position:sticky;top:0}
    h1{margin:0;font-size:18px}
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    .status{padding:10px 12px;border:1px solid #223152;border-radius:12px;background:#0f1a33;margin-bottom:12px;color:#b7c0d6}
    .row{display:flex;gap:10px;margin-bottom:12px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #223152;background:#0f1a33;color:#e8edf7;cursor:pointer}
    button:hover{background:#13204a}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .card{border:1px solid #223152;border-radius:16px;background:#0f1a33;padding:14px}
    .title{font-weight:700;margin:0 0 6px;font-size:16px}
    .meta{color:#b7c0d6;font-size:13px;margin:0 0 10px}
    .price{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #223152;background:#0b1220;font-weight:700}
  </style>
</head>
<body>
  <header><h1>BestFishingSecrets — Firestore Test Feed</h1></header>

  <div class="wrap">
    <div id="status" class="status">Loading…</div>

    <div class="row">
      <button id="reloadBtn">Reload Posts</button>
      <button id="addBtn">Create Test Post</button>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Your exact Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCndtMlIb_Y_YCP1RO-ctfizRU6q1MGeHY",
      authDomain: "bestfishingsecrets-932cf.firebaseapp.com",
      projectId: "bestfishingsecrets-932cf",
      storageBucket: "bestfishingsecrets-932cf.firebasestorage.app",
      messagingSenderId: "387299114354",
      appId: "1:387299114354:web:cbadda074f9dd7083ef1eb",
      measurementId: "G-Z8L28MXNEG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");
    const gridEl = document.getElementById("grid");

    function renderCard(p) {
      const title = p.title || "Untitled Catch";
      const state = p.state || "Unknown";
      const price = p.price || "0";

      return `
        <div class="card">
          <p class="title">${title}</p>
          <p class="meta">State: <b>${state}</b></p>
          <p class="meta"><span class="price">$${price}</span></p>
        </div>
      `;
    }

    async function loadPosts() {
      statusEl.textContent = "Loading posts…";
      gridEl.innerHTML = "";

      try {
        const snap = await getDocs(collection(db, "posts"));

        if (snap.empty) {
          statusEl.textContent = "No posts yet. Click 'Create Test Post'.";
          return;
        }

        let html = "";
        snap.forEach(doc => {
          html += renderCard(doc.data());
        });

        gridEl.innerHTML = html;
        statusEl.textContent = `Loaded ${snap.size} post(s).`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error loading posts. Check Firestore rules.";
      }
    }

    async function createTestPost() {
      try {
        await addDoc(collection(db, "posts"), {
          title: "Test Bass Catch",
          state: "Wisconsin",
          price: 9.99,
          createdAt: serverTimestamp()
        });

        statusEl.textContent = "Test post created.";
        loadPosts();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error creating post. Check Firestore rules.";
      }
    }

    document.getElementById("reloadBtn").onclick = loadPosts;
    document.getElementById("addBtn").onclick = createTestPost;

    loadPosts();
  </script>
</body>
</html>
