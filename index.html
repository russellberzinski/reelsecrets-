<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ReelSecrets • What They Don’t Post on YouTube</title>
  <meta name="description" content="Free sneak peeks. Premium unlocks: full videos + real details serious anglers want." />
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a33; --text:#e8edf7; --muted:#b7c0d6;
      --line:#223152; --accent:#14b8a6; --accent2:#60a5fa; --danger:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:42px;height:42px;border-radius:14px;background:linear-gradient(135deg,var(--accent2),var(--accent));display:grid;place-items:center;font-weight:800}
    .brand h1{font-size:18px;margin:0;line-height:1}
    .brand small{color:var(--muted)}
    .pill{border:1px solid var(--line);padding:8px 12px;border-radius:999px;color:var(--muted)}
    .btn{border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,rgba(96,165,250,.25),rgba(20,184,166,.25))}
    .card{background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:18px;padding:16px;margin-bottom:16px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">RS</div>
        <div>
          <h1>ReelSecrets</h1>
          <small>What They Don’t Post on YouTube</small>
        </div>
      </div>
      <div>
        <span id="firebaseStatus" class="pill">Connecting…</span>
        <button id="loginBtn" class="btn">Log in</button>
        <button id="logoutBtn" class="btn" style="display:none;">Log out</button>
      </div>
    </div>

    <div class="card">
      <h2>Browse previews</h2>
      <div id="posts">Loading posts…</div>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithRedirect,
  getRedirectResult,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  orderBy,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCndtMlIb_Y_YCP1RO-ctfizRU6q1MGeHY",
  authDomain: "bestfishingsecrets-932cf.firebaseapp.com",
  projectId: "bestfishingsecrets-932cf",
  storageBucket: "bestfishingsecrets-932cf.firebasestorage.app",
  messagingSenderId: "387299114354",
  appId: "1:387299114354:web:cbadda074f9dd7083ef1eb",
  measurementId: "G-Z8L28MXNEG"
};

// TODO: Replace with your Stripe payment link
const STRIPE_PAYMENT_LINK = "REPLACE_WITH_STRIPE_LINK";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const status = document.getElementById("firebaseStatus");
const postsEl = document.getElementById("posts");

status.textContent = "Connected to Firebase";

const provider = new GoogleAuthProvider();

loginBtn.onclick = () => signInWithRedirect(auth, provider);
logoutBtn.onclick = () => signOut(auth);

// Handle redirect result
getRedirectResult(auth).catch(console.error);

onAuthStateChanged(auth, (user) => {
  if (user) {
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
  } else {
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
  }
});

// Load posts
const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
onSnapshot(q, (snap) => {
  if (snap.empty) {
    postsEl.innerHTML = "No posts yet.";
    return;
  }

  postsEl.innerHTML = snap.docs.map(doc => {
    const d = doc.data();
    return `
      <div class="card">
        <h3>${d.title}</h3>
        <p>${d.state} • $${d.price}</p>
        <iframe width="100%" height="200" src="${d.previewUrl.replace("watch?v=", "embed/")}" frameborder="0" allowfullscreen></iframe>
        <br><br>
        <button onclick="window.location.href='${STRIPE_PAYMENT_LINK}'" class="btn primary">
          Unlock premium
        </button>
      </div>
    `;
  }).join("");
});
</script>
</body>
</html>
